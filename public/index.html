<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>GGgifts</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f0f0f;
      color: white;
    }

    header {
      padding: 15px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      background: #111;
    }

    .container {
      padding: 15px;
    }

    input, button, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }

    button {
      background: #2ea6ff;
      color: white;
      cursor: pointer;
    }

    .admin {
      margin-top: 20px;
      border-top: 1px solid #333;
      padding-top: 20px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<header onclick="goCases()">GGgifts</header>

<div class="container">

  <div id="main">
    <h3>üé≤ –ö–µ–π—Å—ã</h3>
    <p>–°–∫–æ—Ä–æ —Ç—É—Ç –±—É–¥—É—Ç –∫–µ–π—Å—ã</p>
  </div>

  <div id="admin" class="admin hidden">
    <h3>üëë –ê–¥–º–∏–Ω–∫–∞</h3>

    <input id="userId" placeholder="Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" />
    <input id="amount" placeholder="–°—É–º–º–∞ GG‚≠ê" type="number" />

    <button onclick="addBalance()">‚ûï –ù–∞—á–∏—Å–ª–∏—Ç—å</button>
    <button onclick="removeBalance()">‚ûñ –ó–∞–±—Ä–∞—Ç—å</button>

    <textarea id="broadcastText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º"></textarea>
    <button onclick="broadcast()">üì¢ –†–∞—Å—Å—ã–ª–∫–∞</button>
  </div>

</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  const user = tg.initDataUnsafe.user;
  const ADMIN_ID = user.id;

  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É —Ç–æ–ª—å–∫–æ —Ç–µ–±–µ
  if (user.username === "GGgiftsHelp") {
    document.getElementById("admin").classList.remove("hidden");
  }

  function goCases() {
    document.getElementById("admin").classList.add("hidden");
    document.getElementById("main").classList.remove("hidden");
  }

  async function addBalance() {
    await fetch("/api/admin", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        admin_id: ADMIN_ID,
        action: "add_balance",
        target: Number(userId.value),
        amount: Number(amount.value),
      }),
    });
    alert("–ë–∞–ª–∞–Ω—Å –Ω–∞—á–∏—Å–ª–µ–Ω");
  }

  async function removeBalance() {
    await fetch("/api/admin", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        admin_id: ADMIN_ID,
        action: "remove_balance",
        target: Number(userId.value),
        amount: Number(amount.value),
      }),
    });
    alert("–ë–∞–ª–∞–Ω—Å —É–º–µ–Ω—å—à–µ–Ω");
  }

  async function broadcast() {
    await fetch("/api/broadcast", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        admin_id: ADMIN_ID,
        text: broadcastText.value,
      }),
    });
    alert("–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞");
  }
</script>

</body>
</html>
