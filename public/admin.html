<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GGgifts Admin</title>
<style>
body { background:#0f1116; color:white; font-family:Arial; padding:20px; }
input,button { width:100%; padding:12px; margin-top:10px; border-radius:8px; border:none; }
button { background:#2ea6ff; color:white; font-weight:600; }
.card { background:#1a1d24; padding:15px; border-radius:12px; margin-top:15px; }
</style>
</head>
<body>

<h2>Админка GGgifts</h2>

<input id="search" placeholder="ID или username">
<button onclick="searchUser()">Найти</button>

<div id="userCard"></div>

<hr>

<input id="broadcastText" placeholder="Сообщение всем">
<input type="file" id="photoFile" accept="image/*">
<button onclick="sendAll()">Отправить всем</button>

<script>
const ADMIN_ID = 7461986138;

async function searchUser() {
  const q = document.getElementById('search').value;

  const r = await fetch('/api/admin', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      admin_id: ADMIN_ID,
      action: 'get_user',
      target: q
    })
  });

  const data = await r.json();

  if (!data.user) {
    alert("Пользователь не найден");
    return;
  }

  showProfile(data.user, data.inventory);
}

function showProfile(user, inventory){

  let itemsHtml = "";

  if (!inventory || inventory.length === 0) {
    itemsHtml = "Нет предметов";
  } else {
    inventory.forEach(item => {
      itemsHtml += `
        <div style="margin-top:10px;padding:10px;background:#222;border-radius:8px;">
          ${item.item_name}
          <br>
          <button onclick="deleteItem(${item.id})">
            Забрать предмет
          </button>
        </div>
      `;
    });
  }

  document.getElementById("userCard").innerHTML = `
    <div class="card">
      <b>ID:</b> ${user.telegram_id}<br>
      <b>Username:</b> ${user.username || "-"}<br>
      <b>Balance:</b> ${user.balance}<br>
      <br>

      <input id="newBalance" placeholder="Новый баланс">
      <button onclick="setBalance(${user.telegram_id})">
        Изменить баланс
      </button>

      <button onclick="toggleBan(${user.telegram_id}, ${!user.banned})">
        ${user.banned ? "Разбанить" : "Забанить"}
      </button>

      <hr>

      <b>Инвентарь:</b>
      ${itemsHtml}
    </div>
  `;
}


async function setBalance(id){
  const val = document.getElementById("newBalance").value;
  await fetch("/api/admin",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      admin_id:ADMIN_ID,
      action:"set_balance",
      target:id,
      amount:parseInt(val)
    })
  });
  alert("Баланс изменен");
}

async function toggleBan(id,state){
  await fetch("/api/admin",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      admin_id:ADMIN_ID,
      action:"toggle_ban",
      target:id,
      amount:state
    })
  });
  alert("Готово");
}

  async function deleteItem(itemId) {
  await fetch('/api/admin', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      admin_id: ADMIN_ID,
      action: 'delete_item',
      target: itemId
    })
  });

  alert("Предмет удалён");
}

  <script>
async function sendAll() {
  const text = document.getElementById("broadcastText").value;
  const fileInput = document.getElementById("photoFile");

  const formData = new FormData();
  formData.append("admin_id", ADMIN_ID);
  formData.append("action", "broadcast");
  formData.append("text", text);

  if (fileInput.files.length > 0) {
    formData.append("photo", fileInput.files[0]);
  }

  const r = await fetch("/api/admin", {
    method: "POST",
    body: formData
  });

  const data = await r.json();
  alert("Рассылка отправлена");
}
</script>

</script>

</body>
</html>
