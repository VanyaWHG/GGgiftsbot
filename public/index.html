<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>GGgifts</title>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f0f0f;
      color: white;
    }

    /* TOP BAR */
    #topbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 56px;
      background: #121212;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      border-bottom: 1px solid #222;
      z-index: 10;
    }

    #logo {
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
    }

    #balance {
      font-size: 14px;
      background: #1c1c1c;
      padding: 6px 10px;
      border-radius: 12px;
      cursor: pointer;
    }

    /* CONTENT */
    #content {
      padding-top: 70px;
      padding-bottom: 80px;
      text-align: center;
    }

    .page {
      display: none;
      padding: 20px;
    }

    .page.active {
      display: block;
    }

    /* NAV BAR */
    #nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 64px;
      display: flex;
      background: #121212;
      border-top: 1px solid #222;
    }

    #nav button {
      flex: 1;
      background: #1c1c1c;
      color: #aaa;
      border: none;
      font-size: 12px;
    }

    #nav button.main {
      flex: 1.4;
      background: #2ea6ff;
      color: white;
      font-weight: bold;
      font-size: 14px;
    }
  </style>
</head>
<body>

<!-- TOP -->
<div id="topbar">
  <div id="logo" onclick="showPage('cases')">GGgifts</div>
  <div id="balance" onclick="addBalance()">‚≠ê 0 +</div>
</div>

<!-- CONTENT -->
<div id="content">
  <div id="cases" class="page active">üéÅ <h2>–ö–µ–π—Å—ã</h2></div>
  <div id="upgrade" class="page">üöÄ <h2>–ê–ø–≥—Ä–µ–π–¥</h2></div>
  <div id="craft" class="page">üõ† <h2>–ö—Ä–∞—Ñ—Ç—ã</h2></div>
  <div id="profile" class="page">üë§ <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2></div>
  <div id="settings" class="page">‚öôÔ∏è <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2></div>
  <div id="admin" class="page">üõ° <h2>–ê–¥–º–∏–Ω–∫–∞</h2></div>
</div>

<!-- NAV -->
<div id="nav">
  <button onclick="showPage('upgrade')">–ê–ø–≥—Ä–µ–π–¥</button>
  <button class="main" onclick="showPage('cases')">–ö–µ–π—Å—ã</button>
  <button onclick="showPage('craft')">–ö—Ä–∞—Ñ—Ç—ã</button>
  <button onclick="showPage('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
  <button onclick="showPage('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  const pages = document.querySelectorAll('.page');

  function showPage(id) {
    pages.forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

 async function addBalance() {
  const user = tg.initDataUnsafe?.user;
  if (!user) return;

  const amount = prompt("–°–∫–æ–ª—å–∫–æ ‚≠ê –ø–æ–ø–æ–ª–Ω–∏—Ç—å?");
  if (!amount) return;

  const res = await fetch("/api/topup", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      userId: user.id,
      amount
    })
  });

  const data = await res.json();

  if (data.success) {
    alert(`–ó–∞—á–∏—Å–ª–µ–Ω–æ ‚≠ê${data.added}\n–ö–æ–º–∏—Å—Å–∏—è ‚≠ê${data.fee}`);
    loadBalance();
  } else {
    alert("–û—à–∏–±–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è");
  }
}

  }

  // –∞–¥–º–∏–Ω–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–±—è
  const ADMIN_USERNAME = "GGgiftsHelp";
  if (tg.initDataUnsafe?.user?.username === ADMIN_USERNAME) {
    const adminPage = document.getElementById('admin');
    const adminBtn = document.createElement('button');
    adminBtn.textContent = "–ê–¥–º–∏–Ω–∫–∞";
    adminBtn.onclick = () => showPage('admin');
    document.getElementById('nav').appendChild(adminBtn);
  }
  const user = tg.initDataUnsafe?.user;

  if (user) {
    console.log("Telegram user:", user);

    fetch("/api/user", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        id: user.id,
        username: user.username
      })
    });
  }
  async function loadBalance() {
  const user = tg.initDataUnsafe?.user;
  if (!user) return;

  const res = await fetch(`/api/balance?id=${user.id}`);
  const data = await res.json();

  document.getElementById("balance").innerText =
    `‚≠ê ${data.balance} +`;
}

loadBalance();

</script>

</body>
</html>
